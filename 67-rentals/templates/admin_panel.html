<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - 67 Rentals</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-graph-page.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .admin-card {
            background: rgba(255,255,255,0.9);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.12);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .admin-card:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        .admin-badge {
            padding: 6px 12px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.2px;
        }
        .badge-user { background: #e8f8f5; color: #0e9f6e; }
        .badge-seller { background: #e8f3ff; color: #1d4ed8; }
        .doc-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #eef2ff;
            border-radius: 8px;
            color: #1e3a8a;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .doc-link:hover { background: #e0e7ff; }
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .cta-button.secondary { background: #1f2937; }
        .section-title { margin-bottom: 1rem; }
        .section-subtitle { color: #94a3b8; margin-bottom: 1.5rem; }
        .stat-card .stat-description { color: #94a3b8; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 13h2v8H3zm4-8h2v13H7zm4-2h2v15h-2zm4 4h2v11h-2zm4-2h2v13h-2z"/>
                    </svg>
                </div>
                <span class="logo-text">67 Rentals</span>
            </a>
            <ul class="nav-links">
                <li><a href="{{ url_for('dashboard') }}">Home</a></li>
                <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('accounts') }}" class="active">Accounts</a></li>
                <li><a href="{{ url_for('vehicles_page') }}">Management</a></li>
                <li><a href="{{ url_for('security_dashboard') }}">Security</a></li>
            </ul>
            <a href="{{ url_for('logout') }}" class="cta-button secondary" style="padding:10px 16px;">Logout</a>
            <div class="hamburger" id="hamburger">
                <span></span><span></span><span></span>
            </div>
        </div>
        <ul class="nav-links-mobile" id="navLinksMobile">
            <li><a href="{{ url_for('dashboard') }}">Home</a></li>
            <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('accounts') }}" class="active">Accounts</a></li>
            <li><a href="{{ url_for('vehicles_page') }}">Management</a></li>
            <li><a href="{{ url_for('security_dashboard') }}">Security</a></li>
            <li><a href="{{ url_for('logout') }}">Logout</a></li>
        </ul>
    </nav>

    <!-- Overview -->
    <section class="dashboard-section" id="dashboard">
        <div class="dashboard-container">
            <h2 class="section-title">Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-title">Pending Total</div>
                    </div>
                    <div class="stat-value">{{ (pending_users|length) + (pending_sellers|length) }}</div>
                    <div class="stat-description">Waiting for review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-title">Pending Users</div>
                    </div>
                    <div class="stat-value">{{ pending_users|length }}</div>
                    <div class="stat-description">User signups in queue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üè∑Ô∏è</div>
                        <div class="stat-title">Pending Sellers</div>
                    </div>
                    <div class="stat-value">{{ pending_sellers|length }}</div>
                    <div class="stat-description">Seller signups in queue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-title">Approved</div>
                    </div>
                    <div class="stat-value">{{ (approved_users|length) + (approved_sellers|length) }}</div>
                    <div class="stat-description">Total approvals to date</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-title">Rejected</div>
                    </div>
                    <div class="stat-value">{{ (rejected_users|length) + (rejected_sellers|length) }}</div>
                    <div class="stat-description">Rejected submissions</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Approvals -->
    <section class="analytics-section" id="approvals">
        <div class="dashboard-container">
            <p class="section-subtitle">Review documents, then approve or reject.</p>
            <div class="grid-container" style="margin-top: 1.5rem;">
                <div class="grid-item full-width">
                    <div class="admin-card">
                        <h3 class="section-title" style="margin-top:0;">Users</h3>
                        {% if pending_users %}
                            {% for user in pending_users %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h4 style="margin:0;">{{ user.first_name }} {{ user.last_name }}</h4>
                                            <small style="color:#94a3b8;">Submitted: {{ user.created_at }}</small>
                                        </div>
                                        <span class="admin-badge badge-user">User</span>
                                    </div>
                                    <div class="user-details" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:0.75rem;margin:1rem 0;">
                                        <div class="detail-item"><i class="bi bi-envelope"></i><span>{{ user.email }}</span></div>
                                        <div class="detail-item"><i class="bi bi-telephone"></i><span>{{ user.phone }}</span></div>
                                        <div class="detail-item"><i class="bi bi-person-badge"></i><span>NRIC: {{ user.nric or 'N/A' }}</span></div>
                                        <div class="detail-item"><i class="bi bi-card-checklist"></i><span>License: {{ user.license_number or 'N/A' }}</span></div>
                                    </div>
                                    <div class="document-links" style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:1rem;">
                                        {% if user.nric_image %}
                                        <a href="{{ user.nric_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> NRIC</a>
                                        {% endif %}
                                        {% if user.license_image %}
                                        <a href="{{ user.license_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> License</a>
                                        {% endif %}
                                    </div>
                                    <div class="action-buttons">
                                        <form method="post" action="{{ url_for('admin_reject_user', ticket_id=user.ticket_id) }}">
                                            <button type="submit" class="cta-button secondary" style="padding:10px 14px;">Reject</button>
                                        </form>
                                        <form method="post" action="{{ url_for('admin_approve_user', ticket_id=user.ticket_id) }}">
                                            <button type="submit" class="cta-button" style="padding:10px 14px;">Approve</button>
                                        </form>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No pending user registrations.</p>
                        {% endif %}
                    </div>
                </div>

                <div class="grid-item full-width">
                    <div class="admin-card">
                        <h3 class="section-title" style="margin-top:0;">Sellers</h3>
                        {% if pending_sellers %}
                            {% for seller in pending_sellers %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h4 style="margin:0;">{{ seller.first_name }} {{ seller.last_name }}</h4>
                                            <small style="color:#94a3b8;">Submitted: {{ seller.created_at }}</small>
                                        </div>
                                        <span class="admin-badge badge-seller">Seller</span>
                                    </div>
                                    <div class="user-details" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:0.75rem;margin:1rem 0;">
                                        <div class="detail-item"><i class="bi bi-envelope"></i><span>{{ seller.email }}</span></div>
                                        <div class="detail-item"><i class="bi bi-telephone"></i><span>{{ seller.phone }}</span></div>
                                    </div>
                                    <div class="document-links" style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:1rem;">
                                        {% if seller.nric_image %}<a href="{{ seller.nric_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> NRIC</a>{% endif %}
                                        {% if seller.license_image %}<a href="{{ seller.license_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> License</a>{% endif %}
                                        {% if seller.vehicle_card_image %}<a href="{{ seller.vehicle_card_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> Vehicle Card</a>{% endif %}
                                        {% if seller.insurance_image %}<a href="{{ seller.insurance_image }}" class="doc-link" target="_blank"><i class="bi bi-file-earmark-image"></i> Insurance</a>{% endif %}
                                    </div>
                                    <div class="action-buttons">
                                        <form method="post" action="{{ url_for('admin_reject_user', ticket_id=seller.ticket_id) }}">
                                            <button type="submit" class="cta-button secondary" style="padding:10px 14px;">Reject</button>
                                        </form>
                                        <form method="post" action="{{ url_for('admin_approve_user', ticket_id=seller.ticket_id) }}">
                                            <button type="submit" class="cta-button" style="padding:10px 14px;">Approve</button>
                                        </form>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No pending seller registrations.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Approved -->
    <section class="dashboard-section" id="approved">
        <div class="dashboard-container">
            <h2 class="section-title">Approved</h2>
            <div class="grid-container">
                <div class="grid-item">
                    <div class="admin-card">
                        <h4 style="margin-top:0;">Users</h4>
                        {% if approved_users %}
                            {% for user in approved_users %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ user.first_name }} {{ user.last_name }}</strong><br>
                                            <small style="color:#94a3b8;">Approved: {{ user.reviewed_at or 'N/A' }}</small>
                                        </div>
                                        <span class="admin-badge badge-user">User</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No approved users yet.</p>
                        {% endif %}
                    </div>
                </div>
                <div class="grid-item">
                    <div class="admin-card">
                        <h4 style="margin-top:0;">Sellers</h4>
                        {% if approved_sellers %}
                            {% for seller in approved_sellers %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ seller.first_name }} {{ seller.last_name }}</strong><br>
                                            <small style="color:#94a3b8;">Approved: {{ seller.reviewed_at or 'N/A' }}</small>
                                        </div>
                                        <span class="admin-badge badge-seller">Seller</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No approved sellers yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Rejected -->
    <section class="dashboard-section" id="rejected">
        <div class="dashboard-container">
            <h2 class="section-title">Rejected</h2>
            <div class="grid-container">
                <div class="grid-item">
                    <div class="admin-card">
                        <h4 style="margin-top:0;">Users</h4>
                        {% if rejected_users %}
                            {% for user in rejected_users %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ user.first_name }} {{ user.last_name }}</strong><br>
                                            <small style="color:#94a3b8;">Rejected: {{ user.reviewed_at or 'N/A' }}</small>
                                        </div>
                                        <span class="admin-badge badge-user">User</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No rejected users.</p>
                        {% endif %}
                    </div>
                </div>
                <div class="grid-item">
                    <div class="admin-card">
                        <h4 style="margin-top:0;">Sellers</h4>
                        {% if rejected_sellers %}
                            {% for seller in rejected_sellers %}
                                <div class="admin-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ seller.first_name }} {{ seller.last_name }}</strong><br>
                                            <small style="color:#94a3b8;">Rejected: {{ seller.reviewed_at or 'N/A' }}</small>
                                        </div>
                                        <span class="admin-badge badge-seller">Seller</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="section-subtitle" style="margin:0;">No rejected sellers.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        const hamburger = document.getElementById('hamburger');
        const navLinksMobile = document.getElementById('navLinksMobile');
        hamburger.addEventListener('click', () => {
            navLinksMobile.classList.toggle('open');
            hamburger.classList.toggle('open');
        });
    </script>
</body>
</html>
