
{% set user_email = session.get('user') %}
{% set user_type = session.get('user_type') %}
{% set display_name = session.get('user_name') %}
{% set nav_solid = nav_solid|default(false) %}
{% if not display_name and user_email %}
    {% set display_name = user_email.split('@')[0] %}
{% endif %}

{% if user_type == 'seller' %}
    {% set base_url = url_for('seller_index') %}
    {% set nav_items = [
        {'label': 'Home', 'href': base_url ~ '#section_1', 'id': 'home'},
        {'label': 'About', 'href': base_url ~ '#section_2', 'id': 'about'},
        {'label': 'Vehicles', 'href': url_for('vehicle_listing_seller_logged'), 'id': 'vehicles'},
        {'label': 'Manage Listings', 'href': url_for('manage_listings'), 'id': 'manage'},
        {'label': 'Contact Us', 'href': base_url ~ '#section_4', 'id': 'contact'},
        {'label': 'Cart', 'href': url_for('cart'), 'id': 'cart', 'icon': 'cart'}
    ] %}
{% elif user_type == 'user' %}
    {% set base_url = url_for('index_logged') %}
    {% set nav_items = [
        {'label': 'Home', 'href': base_url ~ '#section_1', 'id': 'home'},
        {'label': 'About', 'href': base_url ~ '#section_2', 'id': 'about'},
        {'label': 'Vehicles', 'href': url_for('vehicle_listing_logged'), 'id': 'vehicles'},
        {'label': 'Report', 'href': url_for('report'), 'id': 'report'},
        {'label': 'Contact Us', 'href': base_url ~ '#section_4', 'id': 'contact'},
        {'label': 'My Bookings', 'href': url_for('booking_history'), 'id': 'bookings'},
        {'label': 'Cart', 'href': url_for('cart_logged'), 'id': 'cart', 'icon': 'cart'}
    ] %}
{% else %}
    {% set base_url = url_for('index') %}
    {% set nav_items = [
        {'label': 'Home', 'href': base_url ~ '#section_1', 'id': 'home'},
        {'label': 'About', 'href': base_url ~ '#section_2', 'id': 'about'},
        {'label': 'Vehicles', 'href': url_for('vehicle_listing'), 'id': 'vehicles'},
        {'label': 'Contact Us', 'href': base_url ~ '#section_4', 'id': 'contact'},
        {'label': 'Cart', 'href': url_for('cart'), 'id': 'cart', 'icon': 'cart'}
    ] %}
{% endif %}


<nav class="navbar navbar-expand-lg{% if nav_solid %} navbar-solid{% endif %}">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="{{ base_url }}">
            <img src="{{ url_for('static', filename='images/logo.png') }}" class="navbar-brand-image img-fluid" alt="67 Rentals">
            <span class="navbar-brand-text">
                67
                <small>Rentals</small>
            </span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-lg-auto">
                {% for item in nav_items %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ item.href }}">
                            {% if item.icon == 'cart' %}
                                <i class="bi bi-cart3"></i> {{ item.label }}
                                {% if cart_count|default(0) > 0 %}
                                    <span class="badge bg-danger">{{ cart_count }}</span>
                                {% endif %}
                            {% else %}
                                {{ item.label }}
                            {% endif %}
                        </a>
                    </li>
                {% endfor %}
                {% if user_email %}
                    <li class="nav-item d-lg-none">
                        <a class="nav-link" href="{{ url_for('profile') }}">
                            <i class="bi bi-person"></i>
                            {{ display_name or user_email }}
                        </a>
                    </li>
                    <li class="nav-item d-lg-none">
                        <a class="nav-link" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </a>
                    </li>
                {% else %}
                    <li class="nav-item d-lg-none">
                        <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
                            Member Login
                        </a>
                    </li>
                {% endif %}
            </ul>

            <div class="d-none d-lg-block ms-lg-3">
                {% if user_email %}
                    <div class="d-flex align-items-center gap-2">
                        <a class="btn custom-btn custom-border-btn d-flex align-items-center gap-2" href="{{ url_for('profile') }}">
                            <i class="bi bi-person"></i>
                            {{ display_name or user_email }}
                        </a>
                        <a class="btn custom-btn custom-border-btn d-flex align-items-center gap-2" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-right"></i>
                            Logout
                        </a>
                    </div>
                {% else %}
                    <a class="btn custom-btn custom-border-btn" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
                        Member Login
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>
