<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="">
        <meta name="author" content="">

        <title>Manage Listings - 67 Rentals</title>

        <!-- CSS FILES -->
        <link rel="preconnect" href="https://fonts.googleapis.com">

        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">

        <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

        <link href="{{ url_for('static', filename='css/bootstrap-icons.css') }}" rel="stylesheet">

        <link href="{{ url_for('static', filename='css/templatemo-tiya-golf-club.css') }}" rel="stylesheet">

        <style>
            :root {
              --white-color:                  #ffffff;
              --primary-color:                #81B29A;
              --secondary-color:              #3D405B;
              --section-bg-color:             #F4F1DE;
              --custom-btn-bg-color:          #F2CC8F;
              --custom-btn-bg-hover-color:    #E07A5F;
              --dark-color:                   #000000;
              --p-color:                      #717275;
              --link-hover-color:             #F2CC8F;

              --body-font-family:             'DM Sans', sans-serif;

              --h1-font-size:                 42px;
              --h2-font-size:                 36px;
              --h3-font-size:                 28px;
              --h4-font-size:                 24px;
              --h5-font-size:                 22px;
              --h6-font-size:                 20px;
              --p-font-size:                  18px;
              --menu-font-size:               16px;
              --btn-font-size:                14px;

              --border-radius-large:          100px;
              --border-radius-medium:         20px;
              --border-radius-small:          10px;

              --font-weight-normal:           400;
              --font-weight-medium:           500;
              --font-weight-bold:             700;
            }

            body {
              background-color: var(--white-color);
              font-family: var(--body-font-family);
            }

            .navbar {
                background: #3D405B;
                z-index: 99;
                padding-top: 15px;
                padding-bottom: 15px;
            }

            .nav-link {
                color: var(--white-color) !important;
                font-weight: 500;
            }

            .nav-link:hover {
                color: #F2CC8F!important;
            }

            .listing-card {
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
                overflow: hidden;
                transition: transform 0.3s ease;
            }

            .listing-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }

            .listing-image {
                width: 100%;
                height: 200px;
                object-fit: cover;
            }

            .listing-body {
                padding: 20px;
            }

            .listing-title {
                font-size: 1.5rem;
                font-weight: 600;
                color: #3D405B;
                margin-bottom: 10px;
            }

            .listing-info {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
                color: #666;
            }

            .listing-status {
                display: inline-block;
                padding: 5px 15px;
                border-radius: 20px;
                font-size: 0.875rem;
                font-weight: 500;
            }

            .status-active {
                background: #d4edda;
                color: #155724;
            }

            .status-inactive {
                background: #f8d7da;
                color: #721c24;
            }

            .status-pending {
                background: #fff3cd;
                color: #856404;
            }

            .listing-actions {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            .tab-buttons {
                margin-bottom: 30px;
            }

            .tab-btn {
                padding: 10px 30px;
                border: 2px solid #81B29A;
                background: white;
                color: #81B29A;
                border-radius: 5px;
                margin-right: 10px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .tab-btn.active {
                background: #81B29A;
                color: white;
            }

            .tab-btn:hover {
                background: #81B29A;
                color: white;
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: #666;
            }

            .empty-state i {
                font-size: 4rem;
                color: #ddd;
                margin-bottom: 20px;
            }

            .cancellation-card {
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
                padding: 20px;
                border-left: 4px solid #F2CC8F;
            }

            .cancellation-header {
                display: flex;
                justify-content: space-between;
                align-items: start;
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid #eee;
            }

            .cancellation-details {
                flex: 1;
            }

            .vehicle-info {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 15px;
            }

            .vehicle-thumbnail {
                width: 80px;
                height: 60px;
                object-fit: cover;
                border-radius: 5px;
            }

            .refund-info {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 5px;
                margin: 15px 0;
            }

            .refund-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }

            .refund-row.total {
                font-weight: 600;
                font-size: 1.1rem;
                padding-top: 8px;
                border-top: 2px solid #dee2e6;
            }

            .badge-pending {
                background: #fff3cd;
                color: #856404;
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 0.875rem;
            }

            .action-buttons {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }
        </style>

    </head>

    <body>

        <main>
<!-- Navbar -->
            {% include 'partials/navbar_tiya.html' %}
<!-- Navbar end -->

            <section class="section-padding mt-5">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4">Manage Your Listings</h2>

                            <!-- Tab Buttons -->
                            <div class="tab-buttons">
                                <button class="tab-btn active" onclick="showTab('view')">
                                    <i class="bi bi-list-ul"></i> View Listings
                                </button>
                                <button class="tab-btn" onclick="showTab('add')">
                                    <i class="bi bi-plus-circle"></i> Add New Listing
                                </button>
                                <a href="{{ url_for('seller_cancellation_requests') }}" class="tab-btn" style="text-decoration: none;">
                                    <i class="bi bi-x-circle"></i> View Cancellations
                                    {% if pending_cancellations_count > 0 %}
                                    <span class="badge bg-warning ms-1">{{ pending_cancellations_count }}</span>
                                    {% endif %}
                                </a>
                            </div>

                            <!-- View Listings Tab -->
                            <div id="view-tab" class="tab-content">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3>Your Listings</h3>
                                    <div>
                                        <select class="form-select" id="filterStatus" onchange="filterListings()">
                                            <option value="all">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row" id="listings-container">
                                    {% if listings %}
                                        {% for listing in listings %}
                                        <div class="col-lg-6 col-12 listing-item" data-status="{{ listing.status }}">
                                            <div class="listing-card">
                                                <img src="{{ url_for('static', filename=listing.image) }}" class="listing-image" alt="{{ listing.name }}">
                                                <div class="listing-body">
                                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                                        <h4 class="listing-title">{{ listing.name }}</h4>
                                                        <span class="listing-status status-{{ listing.status }}">
                                                            {{ listing.status|capitalize }}
                                                        </span>
                                                    </div>

                                                    <div class="listing-info">
                                                        <span><i class="bi bi-fuel-pump"></i> {{ listing.fuel_type }}</span>
                                                        <span><i class="bi bi-geo-alt"></i> {{ listing.location }}</span>
                                                    </div>

                                                    <div class="listing-info">
                                                        <span><i class="bi bi-cash"></i> ${{ listing.price }}/day</span>
                                                        <span><i class="bi bi-calendar-check"></i> {{ listing.bookings }} bookings</span>
                                                    </div>

                                                    <p class="mb-3 text-muted">{{ listing.description[:100] }}...</p>

                                                    <div class="listing-actions">
                                                        <a href="{{ url_for('edit_listing', listing_id=listing.id) }}" class="btn btn-sm btn-outline-primary">
                                                            <i class="bi bi-pencil"></i> Edit
                                                        </a>
                                                        <button type="button" class="btn btn-sm btn-outline-success generate-trip-btn" data-vehicle-id="{{ listing.id }}">
                                                            <i class="bi bi-speedometer2"></i> Generate Trip Metrics
                                                        </button>
                                                        <form action="{{ url_for('toggle_listing_status', listing_id=listing.id) }}" method="POST" style="display: inline;">
                                                            <button type="submit" class="btn btn-sm btn-outline-secondary">
                                                                <i class="bi bi-power"></i>
                                                                {% if listing.status == 'active' %}Deactivate{% else %}Activate{% endif %}
                                                            </button>
                                                        </form>
                                                        <form action="{{ url_for('delete_listing', listing_id=listing.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this listing?');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                                <i class="bi bi-trash"></i> Delete
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="col-12">
                                            <div class="empty-state">
                                                <i class="bi bi-inbox"></i>
                                                <h4>No listings yet</h4>
                                                <p>Start by adding your first vehicle listing</p>
                                                <button class="btn custom-btn mt-3" onclick="showTab('add')">
                                                    <i class="bi bi-plus-circle"></i> Add Your First Listing
                                                </button>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Add New Listing Tab -->
                            <div id="add-tab" class="tab-content" style="display: none;">
                                <div class="row justify-content-center">
                                    <div class="col-lg-8">
                                        <div class="listing-card">
                                            <div class="listing-body">
                                                <h3 class="mb-4">Add New Vehicle Listing</h3>

                                                <form action="{{ url_for('add_listing') }}" method="POST" enctype="multipart/form-data">
                                                    <div class="row">
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">Vehicle Name *</label>
                                                            <input type="text" class="form-control" name="vehicle_name" required placeholder="e.g., Toyota Camry 2023">
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Vehicle Type *</label>
                                                            <select class="form-select" name="vehicle_type" required>
                                                                <option value="">Select Type</option>
                                                                <option value="car">Car</option>
                                                                <option value="motorcycle">Motorcycle</option>
                                                                <option value="van">Van</option>
                                                                <option value="suv">SUV</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Fuel Type *</label>
                                                            <select class="form-select" name="fuel_type" required>
                                                                <option value="">Select Fuel Type</option>
                                                                <option value="petrol">Petrol</option>
                                                                <option value="diesel">Diesel</option>
                                                                <option value="hybrid">Hybrid</option>
                                                                <option value="electric">Electric</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Daily Rental Price ($) *</label>
                                                            <input type="number" class="form-control" name="price" required placeholder="100">
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Pickup Location *</label>
                                                            <input type="text" class="form-control" name="location" required placeholder="e.g., Jurong Point, Singapore">
                                                        </div>

                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">Vehicle Description *</label>
                                                            <textarea class="form-control" name="description" rows="4" required placeholder="Describe your vehicle, its features, and condition..."></textarea>
                                                        </div>

                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">Upload Vehicle Images *</label>
                                                            <input type="file" class="form-control" name="images" accept="image/*" multiple required>
                                                            <small class="text-muted">You can upload multiple images</small>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Seating Capacity</label>
                                                            <input type="number" class="form-control" name="seating" placeholder="5">
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Year of Manufacture</label>
                                                            <input type="number" class="form-control" name="year" placeholder="2023">
                                                        </div>

                                                        <div class="col-12 mb-4">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="terms" required>
                                                                <label class="form-check-label" for="terms">
                                                                    I confirm that all information provided is accurate and I own or have permission to list this vehicle
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <button type="submit" class="btn custom-btn w-100">
                                                                <i class="bi bi-check-circle"></i> Submit Listing
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </section>

        </main>

        <footer class="site-footer" style="background-color: #3D405B; color: white; padding: 40px 0;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-12 text-center text-lg-start mb-3">
                        <span class="navbar-brand-text">
                            67
                            <small>&nbsp; Rentals</small>
                        </span>
                    </div>
                    <div class="col-lg-6 col-12 text-center text-lg-end">
                        <p class="mb-0">Copyright Â© 2048 67 Rentals</p>
                    </div>
                </div>
            </div>
        </footer>



        <!-- JAVASCRIPT FILES -->
        <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.sticky.js') }}"></script>
        <script src="{{ url_for('static', filename='js/custom.js') }}"></script>

        <script>
            function showTab(tabName) {
                // Hide all tabs
                document.getElementById('view-tab').style.display = 'none';
                document.getElementById('add-tab').style.display = 'none';

                // Remove active class from all buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Show selected tab and activate button
                if (tabName === 'view') {
                    document.getElementById('view-tab').style.display = 'block';
                    document.querySelectorAll('.tab-btn')[0].classList.add('active');
                } else if (tabName === 'add') {
                    document.getElementById('add-tab').style.display = 'block';
                    document.querySelectorAll('.tab-btn')[1].classList.add('active');
                }
            }

            function filterListings() {
                const filterValue = document.getElementById('filterStatus').value;
                const listings = document.querySelectorAll('.listing-item');

                listings.forEach(listing => {
                    if (filterValue === 'all' || listing.dataset.status === filterValue) {
                        listing.style.display = 'block';
                    } else {
                        listing.style.display = 'none';
                    }
                });
            }


            function generateTripMetrics(vehicleId, btnEl) {
                if (!vehicleId) {
                    alert('Invalid vehicle');
                    return;
                }

                const originalHtml = btnEl.innerHTML;
                btnEl.disabled = true;
                btnEl.innerHTML = '<i class="bi bi-hourglass-split"></i> Generating...';

                fetch(`/seller/generate-vehicle-metrics/${vehicleId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(r => r.json())
                .then(data => {
                    if (data && data.success) {
                        btnEl.innerHTML = '<i class="bi bi-check-circle"></i> Generated';
                        setTimeout(() => {
                            btnEl.disabled = false;
                            btnEl.innerHTML = originalHtml;
                        }, 1200);
                    } else {
                        const msg = (data && data.error) ? data.error : 'Unknown error';
                        alert('Failed to generate metrics: ' + msg);
                        btnEl.disabled = false;
                        btnEl.innerHTML = originalHtml;
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert('Failed to generate metrics.');
                    btnEl.disabled = false;
                    btnEl.innerHTML = originalHtml;
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.generate-trip-btn').forEach((btn) => {
                    btn.addEventListener('click', () => {
                        const vehicleId = parseInt(btn.getAttribute('data-vehicle-id') || '0', 10);
                        generateTripMetrics(vehicleId, btn);
                    });
                });
            });
        </script>

    </body>
</html>
